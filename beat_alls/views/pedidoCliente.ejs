<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/stilo.css">
    <title><%= titulo %></title> 
</head>
<body>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <%- include('./layout/header.ejs'); -%>
    <br>
    <center><h1><%= enc %></h1></center>
    <br>
    <table border="1">
        <thead>
            <tr>
                <th>Número de pedido</th>
                <th>Nombre del producto</th>
                <th>Descripción</th>
                <th>Cantidad</th>
                <th>Precio unitario</th>
                <th>Acumulado</th>
                <th>Ubicación</th>
                <th>Fecha</th>
                <th>Estado del pedido</th>
            </tr>
        </thead>
        <tbody>
            <% const numerosPedidosUnicos = new Set(consultar_Pedidos.map(pedido => pedido.No_pedido)); %>
            <% numerosPedidosUnicos.forEach(numeroPedido => { %>
                <% const pedidosMismoNumero = consultar_Pedidos.filter(pedido => pedido.No_pedido === numeroPedido); %>
                <tr>
                    <% if (pedidosMismoNumero.length > 0) { %>
                        <td rowspan="<%= pedidosMismoNumero.length %>"><%= numeroPedido %></td>
                        <% pedidosMismoNumero.forEach((pedido, index) => { %>
                            <% if (index !== 0) { %>
                                <tr>
                            <% } %>
                            <td><%= pedido.Nombre_producto %></td>
                            <td><%= pedido.Descripcion %></td>
                            <td><%= pedido.Cantidad_producto %></td>
                            <td><%= pedido.Precio_unitario_producto %></td>
                            <td><%= pedido.Precio_total_productos %></td>
                            <td><%= pedido.Ubicacion %></td>
                            <td><%= pedido.Fecha %></td>
                            <td><%= pedido.Estatus %></td>
                            <% if (index === 0) { %>
                                <td rowspan="<%= pedidosMismoNumero.length %>">
                                    Cantidad a pagar: <%= cantidadPagarPorPedido[numeroPedido] %><br>
                                    <a href="/cancelarPedido">Cancelar pedido</a><br>
                                    <a href="/pagar">Pagar</a>
                                </td>
                            <% } %>
                            <% if (index !== 0) { %>
                                </tr>
                            <% } %>
                        <% }); %>
                    <% } %>
                </tr>
            <% }); %>
        </tbody>     
    </table>
    <br>
    <%- include('./layout/footer.ejs'); -%>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</body>
</html>